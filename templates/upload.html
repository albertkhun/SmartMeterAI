{% extends "base.html" %}

{% block title %}Upload | SmartMeterAI{% endblock %}

{% block content %}
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-800">Upload Smart Meter File</h1>
    <p class="text-gray-500 text-sm">Upload CSV / Excel and generate anomaly risk results.</p>
  </div>

  {% if msg %}
    <div class="p-4 rounded-lg bg-green-100 text-green-800 font-semibold mb-4">
      {{ msg }}
    </div>
  {% endif %}

  <div class="bg-white rounded-2xl shadow p-6">
    <form action="/upload" method="post" enctype="multipart/form-data" class="space-y-4">
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Choose file</label>
        <input type="file" name="file" required accept=".csv,.xlsx,.xls,.tsv"
               class="w-full border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500"/>
        <p class="text-xs text-gray-500 mt-2">
          Supported: CSV, XLSX, XLS, TSV
        </p>
      </div>

      <button type="submit"
              class="w-full py-3 rounded-xl bg-blue-600 text-white font-semibold hover:bg-blue-700 transition">
        Upload & Process
      </button>
    </form>
  </div>

  {% if preview %}
    <div class="mt-8 bg-white rounded-2xl shadow p-6">
      <h2 class="text-lg font-bold text-gray-800 mb-4"> Preview (First 5 Rows)</h2>

      <div class="overflow-x-auto">
        <table class="min-w-full border border-gray-200 text-sm">
          <thead class="bg-gray-100">
            <tr>
              {% for col in preview[0].keys() %}
                <th class="px-4 py-2 border text-left font-semibold text-gray-700">{{ col }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for row in preview %}
              <tr class="hover:bg-gray-50">
                {% for val in row.values() %}
                  <td class="px-4 py-2 border text-gray-700">{{ val }}</td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>
  {% endif %}
{% endblock %}
