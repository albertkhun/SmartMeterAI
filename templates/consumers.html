{% extends "base.html" %}

{% block title %}Consumer Detail | SmartMeterAI{% endblock %}

{% block content %}
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-800">ðŸ‘¤ Consumer Detail: {{ consumer_id }}</h1>
    <p class="text-gray-500 text-sm">Usage trend + Hybrid AI decision</p>
  </div>

  <!-- Risk Summary -->
  <div class="bg-white rounded-2xl shadow p-6 mb-6">
    {% if risk %}
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
          <p class="text-gray-500 text-sm">Risk Score</p>
          <p class="text-3xl font-bold text-gray-900">{{ "%.2f"|format(risk.risk_score) }}</p>
        </div>

        <div>
          <p class="text-gray-500 text-sm">Label</p>
          <p class="font-semibold">{{ risk.label }}</p>
        </div>

        <div class="md:col-span-2">
          <p class="text-gray-500 text-sm">Action</p>
          <p class="font-semibold">{{ risk.action }}</p>
        </div>
      </div>

      <div class="mt-4">
        <p class="text-gray-500 text-sm">Reason</p>
        <p class="text-gray-800 text-sm mt-1">{{ risk.reason }}</p>
      </div>
    {% else %}
      <p class="text-red-600 font-semibold">No risk data found for this consumer.</p>
    {% endif %}
  </div>

  <!-- Usage Trend -->
  <div class="bg-white rounded-2xl shadow p-6">
    <h2 class="text-lg font-bold text-gray-800 mb-3">ðŸ“ˆ Usage Trend</h2>

    {% if timestamps and kwh_values %}
      <div class="h-72">
        <canvas id="usageChart"></canvas>
      </div>
    {% else %}
      <p class="text-gray-500 text-sm">No usage records available for this consumer.</p>
    {% endif %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    const labels = {{ timestamps | tojson }};
    const dataPoints = {{ kwh_values | tojson }};

    if (labels.length > 0 && dataPoints.length > 0) {
      const ctx = document.getElementById('usageChart').getContext('2d');

      new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'kWh',
            data: dataPoints,
            borderWidth: 2,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false
        }
      });
    }
  </script>
{% endblock %}
